<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>采集未达标</title>
    <link rel="stylesheet" type="text/css" href="../easyui/themes/bootstrap/easyui.css"/>
    <link rel="stylesheet" type="text/css" href="../easyui/themes/icon.css"/>
    <script type="text/javascript" src="../easyui/jquery.min.js"></script>
    <script type="text/javascript" src="../easyui/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="../easyui/easyui-lang-zh_CN.js"></script>
    <script type="text/javascript" src="../js/index.js?1"></script>
    <script>
        $(function(){
            //获取参数

            var size = {
                width : document.documentElement.clientWidth,
                height : document.documentElement.clientHeight
            }
            
            function fixWidthWithOptWidth(percent) {
                return  Math.round((Number(size.width-optwidth)) * percent);
            }

            $("#search").on("click",function(){
                var beginDate = $('#beginDate').datebox('getValue');
                var endDate = $('#endDate').datebox('getValue');
                var queryParams = {
                    "beginDate": beginDate,
                    "endDate" : endDate,
                    "departCode" :$('#departCodeSelect').combobox('getValue')
                };
                $('#gatherQualityList').datagrid('load',queryParams);
            });

            $("#reset").on("click",function(){
                $('#beginDate').datebox('setValue', '');
                $('#endDate').datebox('setValue', '');
                $('#departCodeSelect').combobox('setValue', '');
            });

            var size = {
                width : document.documentElement.clientWidth,
                height : document.documentElement.clientHeight
            };
            optwidth = 300;
            $('#departCodeSelect').combobox({
                url: 'sysDepart/fuzzySearchDepart',  //远程访问服务器端的地址
                editable: false,  //设置文本区域不能被编辑
                valueField: 'id',  //显示数据的键的值
                textField: 'text' //显示数据的文本的值
            })
            var res = parseURL(location.href);
            var queryParams = {};
            if(res){
                var departCode = res.departCode;
                if(departCode){
                    //禁用单选下拉列表
                    $('#departCodeSelect').combobox({disabled:true});
                    $('#departCodeSelect').combobox('select',departCode);
                    queryParams['departCode'] = departCode;
                }else{
                    queryParams['departCode'] = "";
                }
                var gatheruserName = res.gatheruserName;
                if(gatheruserName){
                    queryParams['gatheruserName'] = gatheruserName;
                }else{
                    queryParams['gatheruserName'] = "";
                }
                var beginDate = res.beginDate;
                if(beginDate){
                    $('#beginDate').datebox('setValue', beginDate);
                    queryParams['beginDate'] = beginDate;
                }else{
                    queryParams['beginDate'] = "";
                }
                var endDate = res.endDate;
                if(endDate){
                    $('#endDate').datebox('setValue', endDate);
                    queryParams['endDate'] = endDate;
                }else{
                    queryParams['endDate'] = "";
                }
            }

            //加载列表
            $('#gatherQualityList').datagrid({
                url:'statistics/gatherSubstandardExamineList',
                width:size.width-20,
                height:size.height - $('#searchDiv').height() - 60,
                columns:[[
                    {field:"id",title:"ID",hidden:true},
                    {field:"departName",title:"采集单位",width:fixWidthWithOptWidth(0.25)},
                    {field:"gatheruserName",title:"采集人",width:fixWidthWithOptWidth(0.25)},
                    {field:"count",title:"采集总量",width:fixWidthWithOptWidth(0.15)},
                    {field:"substandardCount",title:"未达标数",width:fixWidthWithOptWidth(0.15)},
                    {field:"substandardPercent",title:"未达标率",width:fixWidthWithOptWidth(0.15)},
                    {field:"opt",title:"操作",width:optwidth, formatter: function (value, row, index){
                        var result = '<a href="#" onclick="showDetail(\''+ row.departCode +'\',\''+ row.gatheruserName +'\')">详细信息</a>';
                            return result;
                        }
                    }
                ]],
                pagination : false,
                rownumbers:true
            });
        });

        /**
         * 展示详细信息
         * @param departCode
         * @param gatherUserId
         */
        function showDetail(personId){
            // alert(departCode)
            // alert(gatheruserName);
        }

        function addTab(title, url){
            if ($('#substandard_examine_tab').tabs('exists', title)){
                $('#substandard_examine_tab').tabs('select', title);
            } else {
                var content = '<iframe scrolling="auto" frameborder="0"  src="'+url+'" style="width:100%;height:100%;"></iframe>';
                $('#substandard_examine_tab').tabs('add',{
                    title:title,
                    content:content,
                    closable:true
                });
            }
        }
    </script>
</head>
<body>
<div id="searchDiv">
    <table>
        <tr>
            <td width="100" align="right">采集单位：</td>
            <td>
                <select id="departCodeSelect" style="width: 150px">
                </select>
            </td>
            <td width="100" align="right">时间范围：</td>
            <td width="400">
                <input id="beginDate" data-options="editable:false" class="easyui-datebox"></input> 到 <input id="endDate" data-options="editable:false"  class="easyui-datebox"></input>
            </td>
            <td>
                <a href="#" id="search" class="easyui-linkbutton" data-options="toggle:true">查询</a>
                <a href="#" id="reset" class="easyui-linkbutton" data-options="toggle:true">重置</a>
            </td>
        </tr>
    </table>
</div>
<div>
    <table id="gatherQualityList"></table>
</div>

</body>
</html>